(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{281:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"orm-æ‰©å±•é€‰é¡¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#orm-æ‰©å±•é€‰é¡¹"}},[t._v("#")]),t._v(" ORM æ‰©å±•é€‰é¡¹")]),t._v(" "),s("h2",{attrs:{id:"model-function"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#model-function"}},[t._v("#")]),t._v(" Model Function")]),t._v(" "),s("p",[t._v("ä½ å¯ä»¥åœ¨ Model Function ä¸­è°ƒç”¨ app.api ä¸Šçš„ rest é£æ ¼å‡½æ•°, æ¥å®šåˆ¶å±äºä½ çš„å‡½æ•°, æ¯”å¦‚")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("module"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("db")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" Person "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("define")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'person'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sex")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"male"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"female"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Number\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("functions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n       * getUserByNicknames ä¸º FibAppORMModelFunction ç±»å‹\n       * \n       * @param fibAppReq\n       *    fibAppReq åŒ…å«äº†\n       *    - session\n       *    - query object\n       *    - åŸç”Ÿçš„ request ä¿¡æ¯\n       *        - å¦‚æœ request åœ¨ä¼ ç»™ fib-app ä¹‹å‰ç»è¿‡è¿‡æ»¤è¢«æŒ‚è½½äº†åˆ«çš„å±æ€§, è¿™äº›å±æ€§ä¹Ÿæœ‰æ•ˆ, æ¯”å¦‚ fib-session å¯¹ request æ·»åŠ çš„å­—æ®µ\n       *          - request.session, ä¸ä¸Šä¸€å±‚çš„ session ä¸ºåŒä¸€å¯¹è±¡\n       *          - request.sessionid\n       * \n       * @param fibAppReqData\n       *    æ¥è‡ª POST è¯·æ±‚, `request.json()`, é»˜è®¤ä¸º {}\n       */")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserByNicknames")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("fibAppReq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fibAppReqData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rest get æ“ä½œ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fibAppReq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Person"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fibAppReqData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rest post æ“ä½œ")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" postRes "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fibAppReq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Person"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fibAppReqData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sex")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'male'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("postRes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" postRes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("error\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»ä¸º FibAppModelFunctionResponse ç±»å‹")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" postRes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("ç»å¤§å¤šæ•°æƒé™å¯ä»¥é€šè¿‡ ACL æ§åˆ¶å®Œæˆï¼Œä¸éœ€è¦é€šè¿‡ Function æ¥å®ŒæˆåŸºäºå¯¹è±¡çš„æƒé™. å¯¹äºå¤æ‚æ•°æ®æ“ä½œ, ä½ é€šè¿‡è‡ªå®šä¹‰ Model Function æ¥å®Œæˆ, å¦‚:")]),t._v(" "),s("ul",[s("li",[t._v("åŸºäºæ•°æ®çš„æƒé™, æ¯”å¦‚æ ¹æ®å®¡æ‰¹çŠ¶æ€ï¼Œèµ‹äºˆä¸åŒç”¨æˆ·ç»„æƒé™")]),t._v(" "),s("li",[t._v("å¤šé¡¹ä¿®æ”¹, æ¯”å¦‚éœ€è¦ä¿®æ”¹å¤šæ¡æ•°æ®åº“è®°å½•")]),t._v(" "),s("li",[t._v("åŸºç¡€ Rest æ“ä½œçš„ç»„åˆ")]),t._v(" "),s("li",[t._v("å…¶å®ƒä»»ä½•ä½ è®¤ä¸ºéœ€è¦çš„æ“ä½œ")])]),t._v(" "),s("p",[s("strong",[t._v("NOTICE")]),t._v(" Model Function éƒ½æ˜¯ "),s("code",[t._v("FibAppORMModelFunction")]),t._v(" ç±»å‹, éœ€é€šè¿‡ POST "),s("code",[t._v("/:classname/:func")]),t._v(" çš„æ–¹å¼è¿›è¡Œè°ƒç”¨, åœ¨è°ƒç”¨åˆ° func ä¹‹å‰, request å·²é€šè¿‡ "),s("code",[t._v("app.filterRequest")]),t._v(" è¿›è¡Œè¿‡æ»¤.")]),t._v(" "),s("h2",{attrs:{id:"view-function"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#view-function"}},[t._v("#")]),t._v(" View Function")]),t._v(" "),s("p",[t._v("é€šè¿‡åœ¨ orm çš„ opts ä¸­æ·»åŠ  "),s("code",[t._v("viewFunctions")]),t._v(" , å¯ä»¥å®šä¹‰è¯¥æ¨¡å‹ç›¸å…³çš„è§†å›¾å¤„ç†å‡½æ•°; åŸºäºæ­¤, ä½ å¯ä»¥ä½¿å¾— fib-app å…·æœ‰ç›´æ¥è¾“å‡º html çš„èƒ½åŠ›: å½“æ¥è‡ªå®¢æˆ·ç«¯çš„ http è¯·æ±‚å¤´æ˜¯ "),s("code",[t._v("Accept: text/html")]),t._v(" æ—¶, fib-app ä¼šå°è¯•ä½¿ç”¨ "),s("code",[t._v("viewFunctions")]),t._v(" å®šä¹‰çš„å‡½æ•°å¤„ç†è§†å›¾. å‚è€ƒä¸‹ä¾‹:")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fpug "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fib-pug'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ejs "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ejs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("define")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'user'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sex")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"male"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"female"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("age")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Number"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("salt")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("viewFunctions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * @ctx `Accept: text/html`\n         * \n         * å½“å®¢æˆ·ç«¯å‘èµ·  GET /user/1 æ—¶, ä¼šè°ƒç”¨æ­¤å‡½æ•°;\n         * \n         * å¦‚æœ id=1 çš„ user å­˜åœ¨, åˆ™ result = {sucess: ...}; å¦åˆ™ result = {error: ...}\n         */")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("apiResult"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tpl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fpug"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readTextFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./tpl.get.pug'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tpl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("apiResult "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" apiResult"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * @ctx `Accept: text/html`\n         * \n         * å½“å®¢æˆ·ç«¯å‘èµ·  GET /user æ—¶, ä¼šè°ƒç”¨æ­¤å‡½æ•°\n         * \n         * apiResult = {sucess: ...};\n         */")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("apiResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tpl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ejs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                    fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readTextFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./tpl.find.ejs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tpl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("apiResult "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("users")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" apiResult"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("success"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n         * @ctx `Accept: text/html`\n         * \n         * å½“å®¢æˆ·ç«¯å‘èµ·  GET /user/profile æ—¶, ä¼šè°ƒç”¨æ­¤å‡½æ•°.\n         * \n         * ç”±äº static: true, æ­¤æ—¶ handler çš„ç¬¬ä¸€ä¸ªå‚æ•° _ æ’ä¸º null\n         * \n         * @note æ³¨æ„è¯¥è·¯ç”±ä¸ /user/1 åŒå±äº /:classname/:id æ ¼å¼, ä½† fib-app\n         * ä¼šä¼˜å…ˆå°è¯•è°ƒç”¨è¯¥æ–¹æ³•.\n         * \n         */")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("profile")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/** _ is null */")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("_")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tpl "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ejs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n                        fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readTextFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./tpl.profile.ejs'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tpl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"è°ƒç”¨ä¼˜å…ˆçº§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è°ƒç”¨ä¼˜å…ˆçº§"}},[t._v("#")]),t._v(" è°ƒç”¨ä¼˜å…ˆçº§")]),t._v(" "),s("p",[t._v("å½“å®¢æˆ·ç«¯å‘èµ· "),s("code",[t._v("Accept: text/html")]),t._v(" çš„ http è¯·æ±‚æ—¶, viewFunctions çš„è°ƒç”¨ä¼˜å…ˆçº§æ˜¯è¿™æ ·çš„:")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("/:classname/:idOrFunc")]),t._v(" ==> "),s("code",[t._v("viewFunctions.idOrFunc")]),t._v(" > "),s("code",[t._v("viewFunctions.get")])]),t._v(" "),s("li",[s("code",[t._v("/:classname")]),t._v(" ==> "),s("code",[t._v("viewFunctions.function")])])]),t._v(" "),s("h4",{attrs:{id:"å®šä¹‰é€‰é¡¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®šä¹‰é€‰é¡¹"}},[t._v("#")]),t._v(" å®šä¹‰é€‰é¡¹")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("viewFunctions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// {boolean}, default false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// static === true, apiResult ä¸º null; å¦åˆ™, apiResult ä¸º {success: ...} æˆ– {error: ...}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("apiResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * æ­¤æ—¶ ç­‰ä»·äº \n   * {\n   *    static: true,\n   *    handler: func2\n   * }\n   */")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("func2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ol",[s("li",[t._v("å¦‚æœ "),s("code",[t._v("viewFunction")]),t._v(" çš„ "),s("code",[t._v("static")]),t._v(" ä¸º true, "),s("code",[t._v("viewFunction")]),t._v(" å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º null;")]),t._v(" "),s("li",[t._v("å¦‚æœ "),s("code",[t._v("viewFunctions")]),t._v(" æ²¡æœ‰ "),s("code",[t._v("viewFunction.get")]),t._v(", "),s("code",[t._v("viewFunction.find")]),t._v(", "),s("code",[t._v("viewFunction.eget")]),t._v(", "),s("code",[t._v("viewFunction.efind")]),t._v(" å®šä¹‰æ—¶, æ‰€æœ‰è¯¥å¯¼å‘è¿™äº›\b"),s("code",[t._v("viweFunction")]),t._v("çš„è¯·æ±‚éƒ½ç­‰ä»·äºç›´æ¥è¯·æ±‚å¯¹åº”çš„ "),s("strong",[t._v("fib-app å†…éƒ¨ API æ–¹æ³•")]),t._v(".")]),t._v(" "),s("li",[t._v("å¦‚æœ "),s("code",[t._v("viewFunction")]),t._v(" çš„ "),s("code",[t._v("static")]),t._v(" ä¸ä¸º true, å¦‚æœå­˜åœ¨å¯¹åº”çš„ "),s("strong",[t._v("fib-app å†…éƒ¨ API æ–¹æ³•")]),t._v(" , åˆ™ "),s("code",[t._v("viewFunction")]),t._v(" å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯¥å¯¹åº”æ–¹æ³•çš„è¿”å›å€¼;")])]),t._v(" "),s("p",[t._v("å…³äºç¬¬ 2 ç‚¹, æ¯”å¦‚ Model user æœ‰å¦‚ä¸‹å®šä¹‰")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("viewFunctions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("æ­¤æ—¶å‘èµ· {"),s("code",[t._v("Accept: text/html")]),t._v(", "),s("code",[t._v("GET /user/1")]),t._v("} è¯·æ±‚, ä¸ä¼šé€šè¿‡ viewFunctions å¤„ç†, è¯¥è¯·æ±‚ç­‰ä»·äº {"),s("code",[t._v("Accept: applicaton/json")]),t._v(", "),s("code",[t._v("GET /user/1")]),t._v("} è¯·æ±‚çš„ç»“æœ. åŒç†, æ­¤æ—¶å‘èµ· {"),s("code",[t._v("Accept: text/html")]),t._v(", "),s("code",[t._v("GET /user")]),t._v("} è¯·æ±‚ç­‰ä»·äºå‘èµ· {"),s("code",[t._v("Accept: applicaton/json")]),t._v(", "),s("code",[t._v("GET /user")]),t._v("} è¯·æ±‚.")]),t._v(" "),s("p",[t._v("å…³äºç¬¬ 3 ç‚¹, æ¯”å¦‚ Model user æœ‰å¦‚ä¸‹å®šä¹‰")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("viewFunctions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("func1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("apiResult")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("æ­¤æ—¶å‘èµ· {"),s("code",[t._v("Accept: text/html")]),t._v(", "),s("code",[t._v("GET /user/func1")]),t._v("} è¯·æ±‚, ç”±äºå®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯è¯·æ±‚ id=fun1 çš„ user çš„ä¿¡æ¯, å› æ­¤, å¦‚æœ id=func1 çš„ user çœŸçš„å­˜åœ¨ä¸”å¯ä»¥è¢«è¯·æ±‚é“, åˆ™æ­¤æ—¶ handler çš„ç¬¬ä¸€ä¸ªå‚æ•° apiResult å°±æ˜¯ "),s("code",[t._v("{ success: [userInfo] }")]),t._v("; è‹¥ id=fun1 çš„ user ä¸å­˜åœ¨æˆ–è€…å› ACL æƒé™æ— æ³•è¢«ç”¨æˆ·è®¿é—®åˆ°, åˆ™ apiResult ä¸º "),s("code",[t._v("{ error: ... }")])]),t._v(" "),s("p",[t._v("è¿™ä¸ªç‰¹æ€§æ„å‘³ç€ä½ å¯ä»¥å¯¹æŸäº› Model çš„ç‰¹å®šå¯¹è±¡åšç‰¹æ®Šå¤„ç†, æ¯”å¦‚, å¯¹ id=888 çš„ User è®¾å®šä¸º Lucky Dog, è¿”å›ç‰¹åˆ«çš„ html ç»™å®¢æˆ·ç«¯ ğŸ˜ƒ")]),t._v(" "),s("h3",{attrs:{id:"viewfunction-å¯¹æ¯”-function"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#viewfunction-å¯¹æ¯”-function"}},[t._v("#")]),t._v(" viewFunction å¯¹æ¯” function")]),t._v(" "),s("h4",{attrs:{id:"å…±åŒç‚¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…±åŒç‚¹"}},[t._v("#")]),t._v(" å…±åŒç‚¹")]),t._v(" "),s("p",[s("code",[t._v("viewFunction")]),t._v(" ä¸ "),s("code",[t._v("function")]),t._v(" å¾ˆç›¸ä¼¼")]),t._v(" "),s("ol",[s("li",[t._v("éƒ½è¦è¿”å›ç¬¦åˆ "),s("a",{attrs:{href:"typings/app.d.ts"}},[s("code",[t._v("FibAppResponse")]),t._v(" æ ¼å¼")]),t._v(" çš„å¯¹è±¡")]),t._v(" "),s("li",[t._v("éƒ½æ˜¯ ORM Model çš„å®šä¹‰é€‰é¡¹")])]),t._v(" "),s("h4",{attrs:{id:"åŒºåˆ«"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#åŒºåˆ«"}},[t._v("#")]),t._v(" åŒºåˆ«")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("function")]),t._v(" å¤„ç† fib-app ä¸­çš„ "),s("code",[t._v("POST /:classname/:func")]),t._v(" è¯·æ±‚; "),s("code",[t._v("viewFunctions")]),t._v(" å¤„ç† fib-app ä¸­çš„ "),s("code",[t._v("GET /:classname/:func")]),t._v(" ä¸” "),s("code",[t._v("Accept")]),t._v(" å¤´åŒ…å« "),s("code",[t._v("text/html")]),t._v(" çš„è¯·æ±‚")]),t._v(" "),s("li",[s("code",[t._v("function")]),t._v(" å‡½æ•°çš„è¿”å›å€¼, fib-app ä¼šå°è¯•ä»¥ json çš„æ–¹å¼å†™å…¥ "),s("code",[t._v("HttpResponse")]),t._v("; "),s("code",[t._v("viewFunction")]),t._v(" å‡½æ•°çš„è¿”å›å€¼, fib-app ä¼šå°è¯•ä»¥æ–‡æœ¬çš„æ–¹å¼å†™å…¥ "),s("code",[t._v("HttpResponse")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);