<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ORM æ‰©å±•é€‰é¡¹ | fib-app</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="fibjs-based application resources(RESTful API, SSR, Other resources) management framework">
    
    <link rel="preload" href="/fib-app/assets/css/0.styles.b423d51d.css" as="style"><link rel="preload" href="/fib-app/assets/js/app.d2310b5d.js" as="script"><link rel="preload" href="/fib-app/assets/js/2.5d075586.js" as="script"><link rel="preload" href="/fib-app/assets/js/11.8ede1dd7.js" as="script"><link rel="prefetch" href="/fib-app/assets/js/10.5a0089cb.js"><link rel="prefetch" href="/fib-app/assets/js/12.e63a8fc4.js"><link rel="prefetch" href="/fib-app/assets/js/3.b61d035d.js"><link rel="prefetch" href="/fib-app/assets/js/4.8e7892cc.js"><link rel="prefetch" href="/fib-app/assets/js/5.a81d1c6a.js"><link rel="prefetch" href="/fib-app/assets/js/6.e7cfb7fa.js"><link rel="prefetch" href="/fib-app/assets/js/7.bcbe6134.js"><link rel="prefetch" href="/fib-app/assets/js/8.3f7668b0.js"><link rel="prefetch" href="/fib-app/assets/js/9.c9ab58f0.js">
    <link rel="stylesheet" href="/fib-app/assets/css/0.styles.b423d51d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fib-app/" class="home-link router-link-active"><!----> <span class="site-name">fib-app</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fib-app/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/fib-app/zh/guide.html" class="nav-link">
  æŒ‡å—
</a></div><div class="nav-item"><a href="http://github.com/fibjs/fib-app" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://fibjs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FIBJS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fib-app/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/fib-app/zh/guide.html" class="nav-link">
  æŒ‡å—
</a></div><div class="nav-item"><a href="http://github.com/fibjs/fib-app" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GITHUB
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="http://fibjs.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  FIBJS
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fib-app/zh/getting-started.html" class="sidebar-link">å¿«é€Ÿå¼€å§‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fib-app/zh/getting-started.html#create" class="sidebar-link">create</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/getting-started.html#get" class="sidebar-link">get</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/getting-started.html#find" class="sidebar-link">find</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/getting-started.html#update" class="sidebar-link">update</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/getting-started.html#remove" class="sidebar-link">remove</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/getting-started.html#ä¸‹ä¸€æ­¥å‘¢" class="sidebar-link">ä¸‹ä¸€æ­¥å‘¢?</a></li></ul></li><li><a href="/fib-app/zh/guide.html" class="sidebar-link">æŒ‡å—</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#å»ºç«‹åŸºç¡€è„šæœ¬" class="sidebar-link">å»ºç«‹åŸºç¡€è„šæœ¬</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#api-æ•°æ®æ ¼å¼" class="sidebar-link">API æ•°æ®æ ¼å¼</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#ç‰¹æ®Šå­—æ®µ" class="sidebar-link">ç‰¹æ®Šå­—æ®µ</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#åŸºç¡€å¯¹è±¡è®¿é—®-api" class="sidebar-link">åŸºç¡€å¯¹è±¡è®¿é—® API</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#å»ºç«‹æ‰©å±•å¯¹è±¡" class="sidebar-link">å»ºç«‹æ‰©å±•å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#æ‰©å±•å¯¹è±¡è®¿é—®-api" class="sidebar-link">æ‰©å±•å¯¹è±¡è®¿é—® API</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#acl" class="sidebar-link">ACL</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#ç±»å‹" class="sidebar-link">ç±»å‹</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#utils" class="sidebar-link">Utils</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/guide.html#é«˜çº§ç‰¹æ€§" class="sidebar-link">é«˜çº§ç‰¹æ€§</a></li></ul></li><li><a href="/fib-app/zh/app-acl.html" class="sidebar-link">ACL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#å…³é”®è¯" class="sidebar-link">å…³é”®è¯</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#å®ä¾‹å¯¹è±¡" class="sidebar-link">å®ä¾‹å¯¹è±¡</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#èº«ä»½-ä¸»ä½“-role" class="sidebar-link">èº«ä»½(ä¸»ä½“) / Role</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#æ“ä½œè®¿é—®æ€§" class="sidebar-link">æ“ä½œè®¿é—®æ€§</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#æ“ä½œè®¿é—®æ€§è¡¨-act-descriptor" class="sidebar-link">æ“ä½œè®¿é—®æ€§è¡¨ / Act Descriptor</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#çº§è”çš„èº«ä»½é€‰æ‹©-cascaded-selection-for-acl-role" class="sidebar-link">çº§è”çš„èº«ä»½é€‰æ‹© / Cascaded Selection for ACL Role</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#acl-oacl" class="sidebar-link">ACL/OACL</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#æ“ä½œè®¿é—®æ€§è¡¨ä¸­çš„-extends-extends-in-acl-hash" class="sidebar-link">æ“ä½œè®¿é—®æ€§è¡¨ä¸­çš„ extends / extends in ACL hash</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#èº«ä»½å†²çª" class="sidebar-link">èº«ä»½å†²çª</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-acl.html#è®¸å¯æŸ¥æ‰¾è¿‡ç¨‹" class="sidebar-link">è®¸å¯æŸ¥æ‰¾è¿‡ç¨‹</a></li></ul></li><li><a href="/fib-app/zh/app-model-extends.html" aria-current="page" class="active sidebar-link">ORM æ‰©å±•é€‰é¡¹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fib-app/zh/app-model-extends.html#model-function" class="sidebar-link">Model Function</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-model-extends.html#view-function" class="sidebar-link">View Function</a></li></ul></li><li><a href="/fib-app/zh/app-internal-api.html" class="sidebar-link">å†…éƒ¨ API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fib-app/zh/app-internal-api.html#app-api" class="sidebar-link">app.api.*</a></li><li class="sidebar-sub-header"><a href="/fib-app/zh/app-internal-api.html#ä½¿ç”¨-app-filterrequest-ä¸º-app-å®šåˆ¶ä¸ªæ€§åŒ–çš„è·¯ç”±" class="sidebar-link">ä½¿ç”¨ app.filterRequest ä¸º app å®šåˆ¶ä¸ªæ€§åŒ–çš„è·¯ç”±</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="orm-æ‰©å±•é€‰é¡¹"><a href="#orm-æ‰©å±•é€‰é¡¹" class="header-anchor">#</a> ORM æ‰©å±•é€‰é¡¹</h1> <h2 id="model-function"><a href="#model-function" class="header-anchor">#</a> Model Function</h2> <p>ä½ å¯ä»¥åœ¨ Model Function ä¸­è°ƒç”¨ app.api ä¸Šçš„ rest é£æ ¼å‡½æ•°, æ¥å®šåˆ¶å±äºä½ çš„å‡½æ•°, æ¯”å¦‚</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">db</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> Person <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> Number
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">functions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">/**
       * getUserByNicknames ä¸º FibAppORMModelFunction ç±»å‹
       * 
       * @param fibAppReq
       *    fibAppReq åŒ…å«äº†
       *    - session
       *    - query object
       *    - åŸç”Ÿçš„ request ä¿¡æ¯
       *        - å¦‚æœ request åœ¨ä¼ ç»™ fib-app ä¹‹å‰ç»è¿‡è¿‡æ»¤è¢«æŒ‚è½½äº†åˆ«çš„å±æ€§, è¿™äº›å±æ€§ä¹Ÿæœ‰æ•ˆ, æ¯”å¦‚ fib-session å¯¹ request æ·»åŠ çš„å­—æ®µ
       *          - request.session, ä¸ä¸Šä¸€å±‚çš„ session ä¸ºåŒä¸€å¯¹è±¡
       *          - request.sessionid
       * 
       * @param fibAppReqData
       *    æ¥è‡ª POST è¯·æ±‚, `request.json()`, é»˜è®¤ä¸º {}
       */</span>
      <span class="token function">getUserByNicknames</span> <span class="token punctuation">(</span><span class="token parameter">fibAppReq<span class="token punctuation">,</span> fibAppReqData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// rest get æ“ä½œ</span>
        <span class="token keyword">var</span> data <span class="token operator">=</span> app<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>fibAppReq<span class="token punctuation">,</span> db<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> fibAppReqData<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
        <span class="token comment">// rest post æ“ä½œ</span>
        <span class="token keyword">var</span> postRes <span class="token operator">=</span> app<span class="token punctuation">.</span>api<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>fibAppReq<span class="token punctuation">,</span> db<span class="token punctuation">,</span> Person<span class="token punctuation">,</span> fibAppReqData<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>postRes<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
          <span class="token keyword">throw</span> postRes<span class="token punctuation">.</span>error

        <span class="token comment">// æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»ä¸º FibAppModelFunctionResponse ç±»å‹</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">success</span><span class="token operator">:</span> postRes<span class="token punctuation">.</span>success
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ç»å¤§å¤šæ•°æƒé™å¯ä»¥é€šè¿‡ ACL æ§åˆ¶å®Œæˆï¼Œä¸éœ€è¦é€šè¿‡ Function æ¥å®ŒæˆåŸºäºå¯¹è±¡çš„æƒé™. å¯¹äºå¤æ‚æ•°æ®æ“ä½œ, ä½ é€šè¿‡è‡ªå®šä¹‰ Model Function æ¥å®Œæˆ, å¦‚:</p> <ul><li>åŸºäºæ•°æ®çš„æƒé™, æ¯”å¦‚æ ¹æ®å®¡æ‰¹çŠ¶æ€ï¼Œèµ‹äºˆä¸åŒç”¨æˆ·ç»„æƒé™</li> <li>å¤šé¡¹ä¿®æ”¹, æ¯”å¦‚éœ€è¦ä¿®æ”¹å¤šæ¡æ•°æ®åº“è®°å½•</li> <li>åŸºç¡€ Rest æ“ä½œçš„ç»„åˆ</li> <li>å…¶å®ƒä»»ä½•ä½ è®¤ä¸ºéœ€è¦çš„æ“ä½œ</li></ul> <p><strong>NOTICE</strong> Model Function éƒ½æ˜¯ <code>FibAppORMModelFunction</code> ç±»å‹, éœ€é€šè¿‡ POST <code>/:classname/:func</code> çš„æ–¹å¼è¿›è¡Œè°ƒç”¨, åœ¨è°ƒç”¨åˆ° func ä¹‹å‰, request å·²é€šè¿‡ <code>app.filterRequest</code> è¿›è¡Œè¿‡æ»¤.</p> <h2 id="view-function"><a href="#view-function" class="header-anchor">#</a> View Function</h2> <p>é€šè¿‡åœ¨ orm çš„ opts ä¸­æ·»åŠ  <code>viewFunctions</code> , å¯ä»¥å®šä¹‰è¯¥æ¨¡å‹ç›¸å…³çš„è§†å›¾å¤„ç†å‡½æ•°; åŸºäºæ­¤, ä½ å¯ä»¥ä½¿å¾— fib-app å…·æœ‰ç›´æ¥è¾“å‡º html çš„èƒ½åŠ›: å½“æ¥è‡ªå®¢æˆ·ç«¯çš„ http è¯·æ±‚å¤´æ˜¯ <code>Accept: text/html</code> æ—¶, fib-app ä¼šå°è¯•ä½¿ç”¨ <code>viewFunctions</code> å®šä¹‰çš„å‡½æ•°å¤„ç†è§†å›¾. å‚è€ƒä¸‹ä¾‹:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> fpug <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fib-pug'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">sex</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;male&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;female&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">salt</span><span class="token operator">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token literal-property property">viewFunctions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">/**
         * @ctx `Accept: text/html`
         * 
         * å½“å®¢æˆ·ç«¯å‘èµ·  GET /user/1 æ—¶, ä¼šè°ƒç”¨æ­¤å‡½æ•°;
         * 
         * å¦‚æœ id=1 çš„ user å­˜åœ¨, åˆ™ result = {sucess: ...}; å¦åˆ™ result = {error: ...}
         */</span>
        <span class="token function">get</span> <span class="token punctuation">(</span>apiResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> tpl <span class="token operator">=</span> fpug<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>
                    fs<span class="token punctuation">.</span><span class="token function">readTextFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./tpl.get.pug'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token function">tpl</span><span class="token punctuation">(</span>apiResult <span class="token operator">&amp;&amp;</span> <span class="token punctuation">{</span><span class="token literal-property property">user</span><span class="token operator">:</span> apiResult<span class="token punctuation">.</span>success<span class="token punctuation">}</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/**
         * @ctx `Accept: text/html`
         * 
         * å½“å®¢æˆ·ç«¯å‘èµ·  GET /user æ—¶, ä¼šè°ƒç”¨æ­¤å‡½æ•°
         * 
         * apiResult = {sucess: ...};
         */</span>
        <span class="token function">find</span> <span class="token punctuation">(</span><span class="token parameter">apiResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> tpl <span class="token operator">=</span> ejs<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>
                    fs<span class="token punctuation">.</span><span class="token function">readTextFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./tpl.find.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token function">tpl</span><span class="token punctuation">(</span>apiResult <span class="token operator">&amp;&amp;</span> <span class="token punctuation">{</span><span class="token literal-property property">users</span><span class="token operator">:</span> apiResult<span class="token punctuation">.</span>success<span class="token punctuation">}</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">/**
         * @ctx `Accept: text/html`
         * 
         * å½“å®¢æˆ·ç«¯å‘èµ·  GET /user/profile æ—¶, ä¼šè°ƒç”¨æ­¤å‡½æ•°.
         * 
         * ç”±äº static: true, æ­¤æ—¶ handler çš„ç¬¬ä¸€ä¸ªå‚æ•° _ æ’ä¸º null
         * 
         * @note æ³¨æ„è¯¥è·¯ç”±ä¸ /user/1 åŒå±äº /:classname/:id æ ¼å¼, ä½† fib-app
         * ä¼šä¼˜å…ˆå°è¯•è°ƒç”¨è¯¥æ–¹æ³•.
         * 
         */</span>
        <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token comment">/** _ is null */</span>
            <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> tpl <span class="token operator">=</span> ejs<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>
                        fs<span class="token punctuation">.</span><span class="token function">readTextFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./tpl.profile.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">{</span>
                    <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token function">tpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="è°ƒç”¨ä¼˜å…ˆçº§"><a href="#è°ƒç”¨ä¼˜å…ˆçº§" class="header-anchor">#</a> è°ƒç”¨ä¼˜å…ˆçº§</h4> <p>å½“å®¢æˆ·ç«¯å‘èµ· <code>Accept: text/html</code> çš„ http è¯·æ±‚æ—¶, viewFunctions çš„è°ƒç”¨ä¼˜å…ˆçº§æ˜¯è¿™æ ·çš„:</p> <ul><li><code>/:classname/:idOrFunc</code> ==&gt; <code>viewFunctions.idOrFunc</code> &gt; <code>viewFunctions.get</code></li> <li><code>/:classname</code> ==&gt; <code>viewFunctions.function</code></li></ul> <h4 id="å®šä¹‰é€‰é¡¹"><a href="#å®šä¹‰é€‰é¡¹" class="header-anchor">#</a> å®šä¹‰é€‰é¡¹</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">viewFunctions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">get</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// {boolean}, default false</span>
    <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// static === true, apiResult ä¸º null; å¦åˆ™, apiResult ä¸º {success: ...} æˆ– {error: ...}</span>
    <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token parameter">apiResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token operator">...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * æ­¤æ—¶ ç­‰ä»·äº 
   * {
   *    static: true,
   *    handler: func2
   * }
   */</span>
  <span class="token function">func2</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">success</span><span class="token operator">:</span> <span class="token operator">...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol><li>å¦‚æœ <code>viewFunction</code> çš„ <code>static</code> ä¸º true, <code>viewFunction</code> å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸º null;</li> <li>å¦‚æœ <code>viewFunctions</code> æ²¡æœ‰ <code>viewFunction.get</code>, <code>viewFunction.find</code>, <code>viewFunction.eget</code>, <code>viewFunction.efind</code> å®šä¹‰æ—¶, æ‰€æœ‰è¯¥å¯¼å‘è¿™äº›<code>viweFunction</code>çš„è¯·æ±‚éƒ½ç­‰ä»·äºç›´æ¥è¯·æ±‚å¯¹åº”çš„ <strong>fib-app å†…éƒ¨ API æ–¹æ³•</strong>.</li> <li>å¦‚æœ <code>viewFunction</code> çš„ <code>static</code> ä¸ä¸º true, å¦‚æœå­˜åœ¨å¯¹åº”çš„ <strong>fib-app å†…éƒ¨ API æ–¹æ³•</strong> , åˆ™ <code>viewFunction</code> å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯¥å¯¹åº”æ–¹æ³•çš„è¿”å›å€¼;</li></ol> <p>å…³äºç¬¬ 2 ç‚¹, æ¯”å¦‚ Model user æœ‰å¦‚ä¸‹å®šä¹‰</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">viewFunctions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ­¤æ—¶å‘èµ· {<code>Accept: text/html</code>, <code>GET /user/1</code>} è¯·æ±‚, ä¸ä¼šé€šè¿‡ viewFunctions å¤„ç†, è¯¥è¯·æ±‚ç­‰ä»·äº {<code>Accept: applicaton/json</code>, <code>GET /user/1</code>} è¯·æ±‚çš„ç»“æœ. åŒç†, æ­¤æ—¶å‘èµ· {<code>Accept: text/html</code>, <code>GET /user</code>} è¯·æ±‚ç­‰ä»·äºå‘èµ· {<code>Accept: applicaton/json</code>, <code>GET /user</code>} è¯·æ±‚.</p> <p>å…³äºç¬¬ 3 ç‚¹, æ¯”å¦‚ Model user æœ‰å¦‚ä¸‹å®šä¹‰</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token literal-property property">viewFunctions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">func1</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token function">handler</span> <span class="token punctuation">(</span><span class="token parameter">apiResult</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ­¤æ—¶å‘èµ· {<code>Accept: text/html</code>, <code>GET /user/func1</code>} è¯·æ±‚, ç”±äºå®ƒå¯ä»¥è¢«è®¤ä¸ºæ˜¯è¯·æ±‚ id=fun1 çš„ user çš„ä¿¡æ¯, å› æ­¤, å¦‚æœ id=func1 çš„ user çœŸçš„å­˜åœ¨ä¸”å¯ä»¥è¢«è¯·æ±‚é“, åˆ™æ­¤æ—¶ handler çš„ç¬¬ä¸€ä¸ªå‚æ•° apiResult å°±æ˜¯ <code>{ success: [userInfo] }</code>; è‹¥ id=fun1 çš„ user ä¸å­˜åœ¨æˆ–è€…å› ACL æƒé™æ— æ³•è¢«ç”¨æˆ·è®¿é—®åˆ°, åˆ™ apiResult ä¸º <code>{ error: ... }</code></p> <p>è¿™ä¸ªç‰¹æ€§æ„å‘³ç€ä½ å¯ä»¥å¯¹æŸäº› Model çš„ç‰¹å®šå¯¹è±¡åšç‰¹æ®Šå¤„ç†, æ¯”å¦‚, å¯¹ id=888 çš„ User è®¾å®šä¸º Lucky Dog, è¿”å›ç‰¹åˆ«çš„ html ç»™å®¢æˆ·ç«¯ ğŸ˜ƒ</p> <h3 id="viewfunction-å¯¹æ¯”-function"><a href="#viewfunction-å¯¹æ¯”-function" class="header-anchor">#</a> viewFunction å¯¹æ¯” function</h3> <h4 id="å…±åŒç‚¹"><a href="#å…±åŒç‚¹" class="header-anchor">#</a> å…±åŒç‚¹</h4> <p><code>viewFunction</code> ä¸ <code>function</code> å¾ˆç›¸ä¼¼</p> <ol><li>éƒ½è¦è¿”å›ç¬¦åˆ <a href="typings/app.d.ts"><code>FibAppResponse</code> æ ¼å¼</a> çš„å¯¹è±¡</li> <li>éƒ½æ˜¯ ORM Model çš„å®šä¹‰é€‰é¡¹</li></ol> <h4 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="header-anchor">#</a> åŒºåˆ«</h4> <ol><li><code>function</code> å¤„ç† fib-app ä¸­çš„ <code>POST /:classname/:func</code> è¯·æ±‚; <code>viewFunctions</code> å¤„ç† fib-app ä¸­çš„ <code>GET /:classname/:func</code> ä¸” <code>Accept</code> å¤´åŒ…å« <code>text/html</code> çš„è¯·æ±‚</li> <li><code>function</code> å‡½æ•°çš„è¿”å›å€¼, fib-app ä¼šå°è¯•ä»¥ json çš„æ–¹å¼å†™å…¥ <code>HttpResponse</code>; <code>viewFunction</code> å‡½æ•°çš„è¿”å›å€¼, fib-app ä¼šå°è¯•ä»¥æ–‡æœ¬çš„æ–¹å¼å†™å…¥ <code>HttpResponse</code></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/fib-app/zh/app-acl.html" class="prev">
        ACL
      </a></span> <span class="next"><a href="/fib-app/zh/app-internal-api.html">
        å†…éƒ¨ API
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fib-app/assets/js/app.d2310b5d.js" defer></script><script src="/fib-app/assets/js/2.5d075586.js" defer></script><script src="/fib-app/assets/js/11.8ede1dd7.js" defer></script>
  </body>
</html>
